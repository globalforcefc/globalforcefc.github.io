<!-- TOURNAMENT BRACKET SECTION -->
<section class="bracket-section" style="padding: 80px 20px; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);">
    <div class="container">
        <div class="section-header" style="text-align: center; margin-bottom: 50px;">
            <h2 style="font-size: 3em; color: #fff; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
                üèÜ Tournament Brackets
            </h2>
            <p style="color: #94a3b8; font-size: 1.2em;">Generate fillable tie sheets for any number of teams (4-32)</p>
        </div>

        <!-- Controls -->
        <div class="bracket-controls" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; margin-bottom: 40px;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div>
                    <label style="display: block; color: #10b981; font-weight: bold; margin-bottom: 8px; text-transform: uppercase; font-size: 0.9em;">Tournament Name</label>
                    <input type="text" id="tournamentName" placeholder="e.g., Gen-Z Cup 2026" value="Upcoming Tournament" 
                           style="width: 100%; padding: 15px; background: rgba(15,23,42,0.8); border: 2px solid #334155; color: #fff; border-radius: 10px; font-size: 16px;">
                </div>
                <div>
                    <label style="display: block; color: #10b981; font-weight: bold; margin-bottom: 8px; text-transform: uppercase; font-size: 0.9em;">Number of Teams</label>
                    <input type="number" id="teamCount" min="2" max="32" value="22" 
                           style="width: 100%; padding: 15px; background: rgba(15,23,42,0.8); border: 2px solid #334155; color: #fff; border-radius: 10px; font-size: 16px;">
                </div>
            </div>

            <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                <button onclick="generateTeamInputs()" class="btn btn-secondary" style="padding: 15px 30px; background: #3b82f6; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s;">Update Team List</button>
                <button onclick="autoFillTeams()" class="btn btn-secondary" style="padding: 15px 30px; background: #64748b; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s;">Auto-Fill Teams</button>
                <button onclick="generateBracket()" class="btn btn-primary" style="padding: 15px 40px; background: #10b981; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; font-size: 1.1em; box-shadow: 0 4px 15px rgba(16,185,129,0.3); transition: all 0.3s;">üéØ Generate Bracket</button>
            </div>

            <!-- Team List -->
            <div id="teamListContainer" style="margin-top: 30px; max-height: 400px; overflow-y: auto;">
                <div id="teamInputs" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;"></div>
            </div>
        </div>

        <!-- Bracket Display -->
        <div id="bracketWrapper" style="display: none; background: rgba(255,255,255,0.02); border-radius: 20px; padding: 40px; border: 1px solid rgba(255,255,255,0.05);">
            <h3 id="displayTournamentName" style="text-align: center; color: #10b981; font-size: 2em; margin-bottom: 30px; text-transform: uppercase;"></h3>
            
            <div style="overflow-x: auto; padding: 20px 0;">
                <div id="bracket" style="display: flex; gap: 50px; min-width: max-content;">
                    <!-- Bracket rounds generated here -->
                </div>
            </div>

            <!-- Champion Display -->
            <div id="championDisplay" style="display: none; background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 40px; border-radius: 20px; text-align: center; margin-top: 40px; border: 3px solid #fbbf24; box-shadow: 0 10px 40px rgba(16,185,129,0.3);">
                <div style="font-size: 3em; margin-bottom: 10px;">üèÜ</div>
                <h3 style="color: #fbbf24; font-size: 1.5em; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 3px;">Champion</h3>
                <div id="championName" style="font-size: 2.5em; font-weight: bold; color: white; text-transform: uppercase; letter-spacing: 2px;">-</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
            <button onclick="clearBracket()" style="padding: 12px 25px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">Clear All</button>
            <button onclick="exportData()" style="padding: 12px 25px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">üíæ Save to File</button>
            <input type="file" id="importFile" style="display: none;" onchange="importData(this)">
            <button onclick="document.getElementById('importFile').click()" style="padding: 12px 25px; background: #f59e0b; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">üìÅ Load File</button>
        </div>
    </div>
</section>

<style>
    .match-box {
        background: rgba(255,255,255,0.05);
        border: 2px solid #334155;
        border-radius: 12px;
        margin: 20px 0;
        overflow: hidden;
        min-width: 220px;
        transition: all 0.3s;
    }
    
    .match-box:hover {
        border-color: #10b981;
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(16,185,129,0.2);
    }
    
    .match-team-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        border-bottom: 1px solid #334155;
        background: rgba(15,23,42,0.6);
    }
    
    .match-team-row:last-child {
        border-bottom: none;
    }
    
    .match-team-row.winner {
        background: rgba(16,185,129,0.15);
        border-left: 4px solid #10b981;
    }
    
    .team-name-input {
        background: transparent;
        border: none;
        color: #fff;
        font-size: 14px;
        width: 130px;
        padding: 5px;
        border-radius: 4px;
    }
    
    .team-name-input:focus {
        background: rgba(16,185,129,0.1);
        outline: 1px solid #10b981;
    }
    
    .score-input {
        width: 45px !important;
        text-align: center;
        background: rgba(255,255,255,0.1) !important;
        border: 1px solid #475569 !important;
        color: #fff;
        padding: 5px;
        border-radius: 6px;
        font-weight: bold;
    }
    
    .round-column {
        display: flex;
        flex-direction: column;
        justify-content: space-around;
    }
    
    .round-title {
        text-align: center;
        color: #10b981;
        font-weight: bold;
        font-size: 1.1em;
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: 2px solid #10b981;
        padding-bottom: 10px;
    }
    
    .connector {
        display: flex;
        align-items: center;
        color: #475569;
        font-size: 24px;
        padding: 0 10px;
    }
    
    @media (max-width: 768px) {
        #bracket {
            flex-direction: column;
            gap: 30px !important;
        }
        .match-box {
            min-width: 280px;
        }
    }
</style>

<script>
    let currentTeams = [];

    function generateTeamInputs() {
        const count = parseInt(document.getElementById('teamCount').value) || 22;
        const container = document.getElementById('teamInputs');
        container.innerHTML = '';
        
        for (let i = 0; i < count; i++) {
            const div = document.createElement('div');
            div.style.cssText = 'display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);';
            div.innerHTML = `
                <span style="color: #10b981; font-weight: bold; min-width: 30px;">${i+1}.</span>
                <input type="text" id="team${i}" placeholder="Team ${i+1}" style="flex: 1; background: transparent; border: none; color: #fff; padding: 5px; font-size: 14px;">
            `;
            container.appendChild(div);
        }
    }

    function autoFillTeams() {
        const inputs = document.querySelectorAll('#teamInputs input');
        inputs.forEach((input, idx) => {
            if (!input.value) input.value = `Team ${idx + 1}`;
        });
    }

    function generateBracket() {
        currentTeams = [];
        const inputs = document.querySelectorAll('#teamInputs input');
        inputs.forEach(input => {
            currentTeams.push(input.value || 'TBD');
        });

        if (currentTeams.length < 2) {
            alert('Please add at least 2 teams!');
            return;
        }

        // Calculate bracket size (next power of 2)
        const teamCount = currentTeams.length;
        const rounds = Math.ceil(Math.log2(teamCount));
        const bracketSize = Math.pow(2, rounds);
        
        // Pad with BYEs
        while (currentTeams.length < bracketSize) {
            currentTeams.push('BYE');
        }

        document.getElementById('displayTournamentName').textContent = document.getElementById('tournamentName').value;
        document.getElementById('bracketWrapper').style.display = 'block';
        
        const bracketDiv = document.getElementById('bracket');
        bracketDiv.innerHTML = '';
        
        let roundTeams = [...currentTeams];
        
        for (let r = 0; r < rounds; r++) {
            const roundDiv = document.createElement('div');
            roundDiv.className = 'round-column';
            
            const roundName = r === rounds - 1 ? 'Final' : 
                             r === rounds - 2 ? 'Semi Final' : 
                             r === rounds - 3 ? 'Quarter Final' : 
                             `Round ${r + 1}`;
            
            roundDiv.innerHTML = `<div class="round-title">${roundName}</div>`;
            
            const nextRoundTeams = [];
            
            for (let m = 0; m < roundTeams.length; m += 2) {
                const team1 = roundTeams[m];
                const team2 = roundTeams[m+1];
                const matchId = `r${r}m${m/2}`;
                const isBye = team2 === 'BYE';
                
                const matchBox = document.createElement('div');
                matchBox.className = 'match-box';
                matchBox.innerHTML = `
                    <div class="match-team-row ${isBye ? 'winner' : ''}" id="${matchId}t1">
                        <input type="text" class="team-name-input" value="${team1}" ${team1 === 'BYE' ? 'readonly' : ''}>
                        ${team1 !== 'BYE' ? `<input type="number" class="score-input" min="0" onchange="updateWinner('${matchId}')">` : ''}
                    </div>
                    <div class="match-team-row" id="${matchId}t2" style="${isBye ? 'opacity:0.3' : ''}">
                        <input type="text" class="team-name-input" value="${team2}" ${team2 === 'BYE' || isBye ? 'readonly' : ''}>
                        ${team2 !== 'BYE' && !isBye ? `<input type="number" class="score-input" min="0" onchange="updateWinner('${matchId}')">` : ''}
                    </div>
                `;
                
                roundDiv.appendChild(matchBox);
                nextRoundTeams.push('TBD');
            }
            
            bracketDiv.appendChild(roundDiv);
            roundTeams = nextRoundTeams;
        }

        // Scroll to bracket
        document.getElementById('bracketWrapper').scrollIntoView({ behavior: 'smooth' });
        saveToStorage();
    }

    function updateWinner(matchId) {
        const row1 = document.getElementById(`${matchId}t1`);
        const row2 = document.getElementById(`${matchId}t2`);
        const score1 = row1.querySelector('.score-input')?.value;
        const score2 = row2.querySelector('.score-input')?.value;
        const team1 = row1.querySelector('.team-name-input').value;
        const team2 = row2.querySelector('.team-name-input').value;
        
        row1.classList.remove('winner');
        row2.classList.remove('winner');
        
        if (score1 && score2) {
            const s1 = parseInt(score1);
            const s2 = parseInt(score2);
            
            if (s1 > s2) {
                row1.classList.add('winner');
                advanceTeam(matchId, team1);
            } else if (s2 > s1) {
                row2.classList.add('winner');
                advanceTeam(matchId, team2);
            }
            checkChampion();
        }
        saveToStorage();
    }

    function advanceTeam(matchId, winner) {
        // Parse round and match
        const round = parseInt(matchId.match(/r(\d+)/)[1]);
        const match = parseInt(matchId.match(/m(\d+)/)[1]);
        
        const nextRound = round + 1;
        const nextMatch = Math.floor(match / 2);
        const isTop = match % 2 === 0;
        
        const nextId = `r${nextRound}m${nextMatch}t${isTop ? '1' : '2'}`;
        const nextInput = document.querySelector(`#${nextId} .team-name-input`);
        
        if (nextInput && nextInput.value === 'TBD') {
            nextInput.value = winner;
            nextInput.style.color = '#10b981';
            setTimeout(() => nextInput.style.color = '', 1000);
        }
    }

    function checkChampion() {
        const finals = document.querySelectorAll('.round-column:last-child .match-team-row.winner');
        if (finals.length > 0) {
            const winner = finals[0].querySelector('.team-name-input').value;
            document.getElementById('championName').textContent = winner;
            document.getElementById('championDisplay').style.display = 'block';
        }
    }

    function saveToStorage() {
        const data = {
            name: document.getElementById('tournamentName').value,
            teams: currentTeams,
            timestamp: new Date().toISOString()
        };
        localStorage.setItem('gffc_bracket', JSON.stringify(data));
    }

    function clearBracket() {
        if (confirm('Clear all bracket data?')) {
            localStorage.removeItem('gffc_bracket');
            document.getElementById('bracketWrapper').style.display = 'none';
            document.getElementById('teamInputs').innerHTML = '';
            document.getElementById('teamCount').value = 22;
        }
    }

    function exportData() {
        const data = localStorage.getItem('gffc_bracket');
        if (!data) return alert('No data to save!');
        const blob = new Blob([data], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `tournament_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
    }

    function importData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                localStorage.setItem('gffc_bracket', JSON.stringify(data));
                location.reload();
            } catch (err) {
                alert('Invalid file');
            }
        };
        reader.readAsText(file);
    }

    // Load on startup
    window.addEventListener('load', () => {
        const saved = localStorage.getItem('gffc_bracket');
        if (saved) {
            const data = JSON.parse(saved);
            document.getElementById('tournamentName').value = data.name || '';
            if (data.teams) {
                document.getElementById('teamCount').value = data.teams.length;
                generateTeamInputs();
                // Restore team names
                data.teams.forEach((team, idx) => {
                    const input = document.getElementById(`team${idx}`);
                    if (input) input.value = team;
                });
            }
        } else {
            generateTeamInputs(); // Default 22 teams
        }
    });
</script>
